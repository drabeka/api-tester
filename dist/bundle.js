(()=>{var e=window.React,h=window.React.useState,w=window.React.useEffect,M=window.React.useRef,ae=window.React.createElement,ie=window.React.Fragment;var _=window.ReactDOM,ue=window.ReactDOM.createRoot;function K({apis:t,selectedApiId:s,onSelect:r}){return e.createElement("div",{className:"api-selector"},e.createElement("label",{htmlFor:"api-select"},"API ausw\xE4hlen:"),e.createElement("select",{id:"api-select",value:s||"",onChange:a=>{let u=a.target.value,d=t.find(p=>p.id===u);r(d)},className:"api-select-dropdown"},e.createElement("option",{value:""},"-- Bitte API w\xE4hlen --"),t.map(a=>e.createElement("option",{key:a.id,value:a.id},a.name," (",a.method,")"))),s&&e.createElement("div",{className:"api-info"},t.find(a=>a.id===s)?.description&&e.createElement("p",{className:"api-description"},t.find(a=>a.id===s).description)))}var S={HISTORY:"api_tester_history",FAVORITES:"api_tester_favorites",AUTH:"api_tester_auth"},te=20,H=(t,s=null)=>{try{let r=localStorage.getItem(t);return r?JSON.parse(r):s}catch(r){return console.error(`Error reading from localStorage (${t}):`,r),s}},I=(t,s)=>{try{return localStorage.setItem(t,JSON.stringify(s)),!0}catch(r){return console.error(`Error writing to localStorage (${t}):`,r),!1}},P=()=>H(S.HISTORY,[]),z=t=>{let s=P(),r={id:Date.now(),timestamp:new Date().toISOString(),...t},n=[r,...s].slice(0,te);return I(S.HISTORY,n),r},J=t=>{let r=P().filter(n=>n.id!==t);I(S.HISTORY,r)},X=()=>{I(S.HISTORY,[])},Y=()=>H(S.FAVORITES,[]),Z=t=>{let s=Y(),r=s.indexOf(t);return r>-1?s.splice(r,1):s.push(t),I(S.FAVORITES,s),s},G=t=>Y().includes(t),O=t=>H(S.AUTH,{})[t]||null,W=(t,s)=>{let r=H(S.AUTH,{});r[t]=s,I(S.AUTH,r)},Q=t=>{let s=H(S.AUTH,{});delete s[t],I(S.AUTH,s)};var ne=3e4;async function R(t){let{endpoint:s,method:r="POST",payload:n={},authConfig:a=null,apiId:u,apiName:d,timeout:p=ne,useProxy:g=!0,contentType:b="application/json",accept:T="*/*"}=t,l={};T&&(l.Accept=T);let x=n&&(typeof n=="string"?n.length>0:Object.keys(n).length>0);["POST","PUT","PATCH"].includes(r.toUpperCase())&&x&&(l["Content-Type"]=b),a&&(a.type==="bearer"?l.Authorization=`Bearer ${a.token}`:a.type==="apikey"&&(l[a.headerName||"X-API-Key"]=a.apiKey));let c=Date.now(),f=null,y=null,o=null;try{let m=new AbortController,A=setTimeout(()=>m.abort(),p),N,E;g?(E="/api/proxy",N={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:s,method:r,headers:l,body:["POST","PUT","PATCH"].includes(r.toUpperCase())?n:void 0}),signal:m.signal}):(E=s,N={method:r,headers:l,signal:m.signal},["POST","PUT","PATCH"].includes(r.toUpperCase())&&(N.body=JSON.stringify(n))),f=await fetch(E,N),clearTimeout(A);let C=await f.text();try{y=JSON.parse(C)}catch{y=C}}catch(m){o=m,m.name==="AbortError"&&(o=new Error(`Request timeout after ${p}ms`))}let v=Date.now()-c,i={apiId:u,apiName:d,endpoint:s,method:r,payload:n,status:f?f.status:0,statusText:f?f.statusText:"Network Error",responseData:y,error:o?o.message:null,duration:v};if(z(i),o)throw o;return{ok:f.ok,status:f.status,statusText:f.statusText,data:y,headers:Object.fromEntries(f.headers.entries()),duration:v}}function L(t){return typeof t=="object"?JSON.stringify(t,null,2):String(t)}function ee(t,s){let r={};return t.forEach(n=>{let a=s[n.name];if(n.required&&(a==null||a==="")){r[n.name]=n.requiredError||`${n.label} ist erforderlich`;return}if(!(a==null||a==="")){if(n.type==="number"){let u=parseFloat(a);if(isNaN(u)){r[n.name]=`${n.label} muss eine Zahl sein`;return}if(n.min!==void 0&&u<n.min){r[n.name]=n.minError||`${n.label} muss mindestens ${n.min} sein`;return}if(n.max!==void 0&&u>n.max){r[n.name]=n.maxError||`${n.label} darf maximal ${n.max} sein`;return}}if(n.type==="text"||n.type==="textarea"){let u=String(a);if(n.minLength!==void 0&&u.length<n.minLength){r[n.name]=n.minLengthError||`${n.label} muss mindestens ${n.minLength} Zeichen lang sein`;return}if(n.maxLength!==void 0&&u.length>n.maxLength){r[n.name]=n.maxLengthError||`${n.label} darf maximal ${n.maxLength} Zeichen lang sein`;return}if(n.pattern&&!new RegExp(n.pattern).test(u)){r[n.name]=n.patternError||`${n.label} hat ein ung\xFCltiges Format`;return}}}}),{valid:Object.keys(r).length===0,errors:r}}function k({label:t,type:s="text",name:r,value:n,onChange:a,required:u=!1,error:d=null,placeholder:p="",helpText:g="",step:b,rows:T=4,options:l=[],min:x,max:c,minLength:f,maxLength:y,pattern:o,children:v,className:i=""}){let m=r||`field-${Math.random().toString(36).substring(2,11)}`,A=()=>{if(s==="select")return e.createElement("select",{id:m,value:n||"",onChange:a,required:u},l.map(E=>e.createElement("option",{key:E.value,value:E.value},E.label)));if(s==="textarea")return e.createElement("textarea",{id:m,value:n||"",onChange:a,required:u,rows:T,placeholder:p,minLength:f,maxLength:y});let N={type:s,id:m,value:n||"",onChange:a,required:u,placeholder:p};return s==="number"&&(b!==void 0&&(N.step=b),x!==void 0&&(N.min=x),c!==void 0&&(N.max=c)),s==="text"&&(f!==void 0&&(N.minLength=f),y!==void 0&&(N.maxLength=y),o&&(N.pattern=o)),s==="date"&&(x!==void 0&&(N.min=x),c!==void 0&&(N.max=c)),e.createElement("input",{...N})};return e.createElement("div",{className:`form-group ${i}`.trim()},e.createElement("label",{htmlFor:m},t,u&&e.createElement("span",{className:"required"},"*")),A(),d&&e.createElement("span",{className:"error-message"},d),g&&e.createElement("small",{className:"help-text"},g),v)}function F({icon:t,message:s,children:r,className:n=""}){return e.createElement("div",{className:`no-history ${n}`.trim()},t&&e.createElement("div",{style:{fontSize:"2em",marginBottom:"10px"}},t),e.createElement("p",null,s),r)}function D({api:t,onResponse:s,initialValues:r=null}){let[n,a]=h({}),[u,d]=h({}),[p,g]=h(!1);w(()=>{if(t){let o={};b(t).forEach(i=>{r&&r[i.name]!==void 0?o[i.name]=r[i.name]:o[i.name]=i.defaultValue!==void 0?i.defaultValue:""}),a(o),d({})}},[t,r]);let b=o=>o.sections?o.sections.flatMap(v=>v.fields||[]):o.fields||[],T=(o,v)=>{a(i=>({...i,[o]:v})),u[o]&&d(i=>{let m={...i};return delete m[o],m})},l=async o=>{o.preventDefault();let i=b(t).filter(A=>f(A)),m=ee(i,n);if(!m.valid){d(m.errors);return}g(!0),d({});try{let A={};i.forEach(C=>{n[C.name]!==void 0&&(A[C.name]=n[C.name])});let N=O(t.id),E=await R({endpoint:t.endpoint,method:t.method,payload:A,authConfig:N,apiId:t.id,apiName:t.name,contentType:t.contentType,accept:t.accept,useProxy:t.corsProxy!==!1});s(E)}catch(A){s({ok:!1,status:0,statusText:"Error",data:null,error:A.message})}finally{g(!1)}},x=o=>{o.ctrlKey&&o.key==="Enter"&&l(o)},c=()=>{if(!t)return;let o={};b(t).forEach(i=>{let m=i.exampleValue!==void 0?i.exampleValue:i.defaultValue;m!==void 0&&(o[i.name]=m)}),a(o),d({})};if(!t)return e.createElement("div",{className:"request-form"},e.createElement(F,{icon:"\u{1F4DD}",message:"Bitte w\xE4hlen Sie eine API aus."}));let f=o=>{if(!o.showIf)return!0;let{field:v,value:i}=o.showIf,m=n[v];return Array.isArray(i)?i.includes(m):m===i},y=o=>{if(!f(o))return null;let v=i=>{let m=o.type==="number"?i.target.value===""?"":parseFloat(i.target.value):i.target.value;T(o.name,m)};return e.createElement(k,{key:o.name,label:o.label,type:o.type,name:o.name,value:n[o.name],onChange:v,required:o.required,error:u[o.name],placeholder:o.placeholder,helpText:o.helpText,step:o.step,rows:o.rows||4,options:o.options,min:o.min,max:o.max,minLength:o.minLength,maxLength:o.maxLength,pattern:o.pattern})};return e.createElement("form",{className:"request-form",onSubmit:l,onKeyDown:x},t.sections?t.sections.map((o,v)=>e.createElement("div",{key:v,className:"form-section"},o.title&&e.createElement("h4",{className:"section-title"},o.title),o.description&&e.createElement("p",{className:"section-description"},o.description),e.createElement("div",{className:"section-fields"},(o.fields||[]).map(i=>y(i))))):(t.fields||[]).map(o=>y(o)),e.createElement("div",{className:"form-actions"},e.createElement("button",{type:"submit",className:"btn-primary btn-submit",disabled:p},p?"Sende...":"API aufrufen"),e.createElement("button",{type:"button",className:"btn-secondary",onClick:c},"\u{1F4CB} Beispielwerte f\xFCllen"),e.createElement("small",{className:"hint"},"Tipp: Strg+Enter zum Absenden")))}function $({variant:t="status",type:s="success",children:r,className:n=""}){let a="";return t==="status"?a=`status-badge ${s==="success"?"status-success":"status-error"}`:t==="duration"&&(a="duration-badge"),e.createElement("div",{className:`${a} ${n}`.trim()},r)}function q({response:t}){let s=M(null),r=n=>(typeof n!="string"&&(n=L(n)),n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"([^"]+)":/g,'<span class="json-key">"$1"</span>:').replace(/: "([^"]*)"/g,': <span class="json-string">"$1"</span>').replace(/: (true|false)/g,': <span class="json-boolean">$1</span>').replace(/: (null)/g,': <span class="json-null">$1</span>').replace(/: (-?\d+\.?\d*)/g,': <span class="json-number">$1</span>'));return w(()=>{if(s.current&&t&&t.data!==null){let n=L(t.data),a=r(n);s.current.innerHTML=a}},[t]),t?e.createElement("div",{className:"response-viewer"},e.createElement("div",{className:"response-header"},e.createElement("h3",null,"Response"),e.createElement($,{variant:"status",type:t.ok?"success":"error"},"HTTP ",t.status," ",t.statusText),t.duration&&e.createElement($,{variant:"duration"},t.duration,"ms")),t.error?e.createElement("pre",{className:"response-content error"},"Fehler: ",t.error):e.createElement("pre",{ref:s,className:"response-content"})):e.createElement("div",{className:"response-viewer"},e.createElement("h3",null,"Response"),e.createElement("pre",{className:"response-content"},"Noch keine Anfrage gesendet."))}function B({apiId:t}){let[s,r]=h("none"),[n,a]=h(""),[u,d]=h(""),[p,g]=h("X-API-Key");w(()=>{if(t){let l=O(t);l?(r(l.type),a(l.token||""),d(l.apiKey||""),g(l.headerName||"X-API-Key")):(r("none"),a(""),d(""),g("X-API-Key"))}},[t]);let b=()=>{if(!t)return;let l={type:s};s==="bearer"?l.token=n:s==="apikey"&&(l.apiKey=u,l.headerName=p),W(t,l),alert("Auth-Konfiguration gespeichert!")},T=()=>{t&&(Q(t),r("none"),a(""),d(""),g("X-API-Key"),alert("Auth-Konfiguration gel\xF6scht!"))};return t?e.createElement("div",{className:"auth-config"},e.createElement("h3",null,"Authentifizierung"),e.createElement(k,{label:"Auth-Typ:",type:"select",name:"auth-type",value:s,onChange:l=>r(l.target.value),options:[{value:"none",label:"Keine"},{value:"bearer",label:"Bearer Token"},{value:"apikey",label:"API Key"}]}),s==="bearer"&&e.createElement(k,{label:"Bearer Token:",type:"text",name:"bearer-token",value:n,onChange:l=>a(l.target.value),placeholder:"Token eingeben..."},e.createElement("small",{className:"warning"},"\u26A0\uFE0F Nur f\xFCr Testzwecke! Token wird in LocalStorage gespeichert.")),s==="apikey"&&e.createElement(e.Fragment,null,e.createElement(k,{label:"API Key:",type:"text",name:"api-key",value:u,onChange:l=>d(l.target.value),placeholder:"API Key eingeben..."}),e.createElement(k,{label:"Header-Name:",type:"text",name:"header-name",value:p,onChange:l=>g(l.target.value),placeholder:"z.B. X-API-Key"},e.createElement("small",{className:"warning"},"\u26A0\uFE0F Nur f\xFCr Testzwecke! Key wird in LocalStorage gespeichert."))),e.createElement("div",{className:"auth-actions"},e.createElement("button",{onClick:b,className:"btn-primary"},"Speichern"),e.createElement("button",{onClick:T,className:"btn-secondary"},"L\xF6schen"))):e.createElement("div",{className:"auth-config"},e.createElement(F,{icon:"\u{1F510}",message:"Bitte w\xE4hlen Sie zuerst eine API aus."}))}function U({item:t,isFavorite:s,onToggleFavorite:r,onReplay:n,onDelete:a}){let u=t.status>=200&&t.status<300?"status-success":"status-error",d=p=>new Date(p).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.createElement("div",{className:"history-item"},e.createElement("div",{className:"history-item-header"},e.createElement("span",{className:"api-name"},t.apiName),e.createElement("span",{className:`status ${u}`},t.status," ",t.statusText),e.createElement("span",{className:"timestamp"},d(t.timestamp))),e.createElement("div",{className:"history-item-details"},e.createElement("div",{className:"endpoint"},e.createElement("strong",null,t.method)," ",t.endpoint),t.duration&&e.createElement("div",{className:"duration"},t.duration,"ms")),e.createElement("div",{className:"history-item-actions"},e.createElement("button",{className:"btn-icon",onClick:()=>r(t.id),title:s?"Favorit entfernen":"Als Favorit markieren"},s?"\u2B50":"\u2606"),e.createElement("button",{className:"btn-small btn-primary",onClick:()=>n(t)},"\u21BB Wiederholen"),e.createElement("button",{className:"btn-small btn-danger",onClick:()=>a(t.id)},"\u{1F5D1}\uFE0F L\xF6schen")))}function V({onReplay:t}){let[s,r]=h([]),[n,a]=h([]),[u,d]=h("all"),p=()=>{let c=P();r(c);let f=c.filter(y=>G(y.id)).map(y=>y.id);a(f)};w(()=>{p()},[]);let g=c=>{confirm("M\xF6chten Sie diesen Eintrag wirklich l\xF6schen?")&&(J(c),p())},b=()=>{confirm("M\xF6chten Sie die gesamte Historie wirklich l\xF6schen?")&&(X(),p())},T=c=>{Z(c),p()},l=c=>{t({apiId:c.apiId,payload:c.payload})},x=u==="favorites"?s.filter(c=>n.includes(c.id)):s;return e.createElement("div",{className:"history"},e.createElement("div",{className:"history-header"},e.createElement("h3",null,"Request-Historie"),e.createElement("div",{className:"history-controls"},e.createElement("div",{className:"filter-buttons"},e.createElement("button",{className:u==="all"?"active":"",onClick:()=>d("all")},"Alle (",s.length,")"),e.createElement("button",{className:u==="favorites"?"active":"",onClick:()=>d("favorites")},"\u2B50 Favoriten (",n.length,")")),s.length>0&&e.createElement("button",{className:"btn-danger btn-small",onClick:b},"Alle l\xF6schen"))),x.length===0?e.createElement(F,{icon:u==="favorites"?"\u2B50":"\u{1F4DC}",message:u==="favorites"?"Keine Favoriten vorhanden.":"Noch keine Requests in der Historie."}):e.createElement("div",{className:"history-list"},x.map(c=>e.createElement(U,{key:c.id,item:c,isFavorite:n.includes(c.id),onToggleFavorite:T,onReplay:l,onDelete:g}))))}function j({tabs:t,activeTab:s,onChange:r,className:n=""}){return e.createElement("div",{className:`tabs ${n}`.trim()},t.map(a=>e.createElement("button",{key:a.id,className:`tab ${s===a.id?"active":""}`,onClick:()=>r(a.id)},a.label)))}function se(){let[t,s]=h([]),[r,n]=h(null),[a,u]=h(null),[d,p]=h(null),[g,b]=h("request"),[T,l]=h(!0),[x,c]=h(null);w(()=>{f()},[]);let f=async()=>{try{l(!0);let i=await fetch("/config/apis.json");if(!i.ok)throw new Error(`Fehler beim Laden der APIs: ${i.statusText}`);let m=await i.json();s(m.apis||[]),m.apis&&m.apis.length>0&&n(m.apis[0]),l(!1)}catch(i){c(i.message),l(!1),console.error("Fehler beim Laden der APIs:",i)}},y=i=>{n(i),u(null),p(null),b("request")},o=i=>{u(i)},v=i=>{let m=t.find(A=>A.id===i.apiId);m&&(n(m),p(i.payload),b("request"))};return T?e.createElement("div",{className:"app-container"},e.createElement("div",{className:"loading"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"Lade API-Konfiguration..."))):x?e.createElement("div",{className:"app-container"},e.createElement(F,{icon:"\u274C",message:"Fehler beim Laden"},e.createElement("p",{style:{marginTop:"10px"}},x),e.createElement("button",{onClick:f,className:"btn-primary",style:{marginTop:"15px"}},"Erneut versuchen"))):t.length===0?e.createElement("div",{className:"app-container"},e.createElement(F,{icon:"\u2699\uFE0F",message:"Keine APIs konfiguriert"},e.createElement("p",{style:{marginTop:"10px"}},"Bitte f\xFCgen Sie API-Definitionen in ",e.createElement("code",null,"config/apis.json")," hinzu."))):e.createElement("div",{className:"app-container"},e.createElement("header",{className:"app-header"},e.createElement("h1",null,"\u{1F680} API Test Framework"),e.createElement("p",{className:"subtitle"},"Flexibles Testing f\xFCr REST APIs")),e.createElement("div",{className:"api-selector-container"},e.createElement(K,{apis:t,selectedApiId:r?.id,onSelect:y})),e.createElement("div",{className:"main-content"},e.createElement("div",{className:"sidebar"},e.createElement(j,{activeTab:g,onChange:b,tabs:[{id:"request",label:"\u{1F4DD} Request"},{id:"auth",label:"\u{1F510} Auth"},{id:"history",label:"\u{1F4DC} Historie"}]}),e.createElement("div",{className:"tab-content"},g==="request"&&e.createElement(D,{api:r,onResponse:o,initialValues:d}),g==="auth"&&e.createElement(B,{apiId:r?.id}),g==="history"&&e.createElement(V,{onReplay:v}))),e.createElement("div",{className:"response-panel"},e.createElement(q,{response:a}))),e.createElement("footer",{className:"app-footer"},e.createElement("p",null,"API Test Framework v1.0 | React + esbuild")))}var re=_.createRoot(document.getElementById("root"));re.render(e.createElement(se,null));})();
