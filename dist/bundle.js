(()=>{var e=window.React,d=window.React.useState,T=window.React.useEffect,U=window.React.useRef,te=window.React.createElement,se=window.React.Fragment;var L=window.ReactDOM,re=window.ReactDOM.createRoot;function H({apis:t,selectedApiId:n,onSelect:r}){return e.createElement("div",{className:"api-selector"},e.createElement("label",{htmlFor:"api-select"},e.createElement("strong",null,"API ausw\xE4hlen:")),e.createElement("select",{id:"api-select",value:n||"",onChange:i=>{let c=i.target.value,p=t.find(m=>m.id===c);r(p)},className:"api-select-dropdown"},e.createElement("option",{value:""},"-- Bitte API w\xE4hlen --"),t.map(i=>e.createElement("option",{key:i.id,value:i.id},i.name," (",i.method,")"))),n&&e.createElement("div",{className:"api-info"},t.find(i=>i.id===n)?.description&&e.createElement("p",{className:"api-description"},t.find(i=>i.id===n).description)))}var A={HISTORY:"api_tester_history",FAVORITES:"api_tester_favorites",AUTH:"api_tester_auth"},W=20,w=(t,n=null)=>{try{let r=localStorage.getItem(t);return r?JSON.parse(r):n}catch(r){return console.error(`Error reading from localStorage (${t}):`,r),n}},S=(t,n)=>{try{return localStorage.setItem(t,JSON.stringify(n)),!0}catch(r){return console.error(`Error writing to localStorage (${t}):`,r),!1}},x=()=>w(A.HISTORY,[]),j=t=>{let n=x(),r={id:Date.now(),timestamp:new Date().toISOString(),...t},a=[r,...n].slice(0,W);return S(A.HISTORY,a),r},B=t=>{let r=x().filter(a=>a.id!==t);S(A.HISTORY,r)},_=()=>{S(A.HISTORY,[])},M=()=>w(A.FAVORITES,[]),z=t=>{let n=M(),r=n.indexOf(t);return r>-1?n.splice(r,1):n.push(t),S(A.FAVORITES,n),n},J=t=>M().includes(t),F=t=>w(A.AUTH,{})[t]||null,X=(t,n)=>{let r=w(A.AUTH,{});r[t]=n,S(A.AUTH,r)},Y=t=>{let n=w(A.AUTH,{});delete n[t],S(A.AUTH,n)};var Q=3e4;async function V(t){let{endpoint:n,method:r="POST",payload:a={},authConfig:i=null,apiId:c,apiName:p,timeout:m=Q,useProxy:h=!0,contentType:v="application/json",accept:N="*/*"}=t,l={};N&&(l.Accept=N);let o=a&&(typeof a=="string"?a.length>0:Object.keys(a).length>0);["POST","PUT","PATCH"].includes(r.toUpperCase())&&o&&(l["Content-Type"]=v),i&&(i.type==="bearer"?l.Authorization=`Bearer ${i.token}`:i.type==="apikey"&&(l[i.headerName||"X-API-Key"]=i.apiKey));let u=Date.now(),s=null,f=null,b=null;try{let y=new AbortController,I=setTimeout(()=>y.abort(),m),C,E;h?(E="/api/proxy",C={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,method:r,headers:l,body:["POST","PUT","PATCH"].includes(r.toUpperCase())?a:void 0}),signal:y.signal}):(E=n,C={method:r,headers:l,signal:y.signal},["POST","PUT","PATCH"].includes(r.toUpperCase())&&(C.body=JSON.stringify(a))),s=await fetch(E,C),clearTimeout(I);let $=await s.text();try{f=JSON.parse($)}catch{f=$}}catch(y){b=y,y.name==="AbortError"&&(b=new Error(`Request timeout after ${m}ms`))}let k=Date.now()-u,g={apiId:c,apiName:p,endpoint:n,method:r,payload:a,status:s?s.status:0,statusText:s?s.statusText:"Network Error",responseData:f,error:b?b.message:null,duration:k};if(j(g),b)throw b;return{ok:s.ok,status:s.status,statusText:s.statusText,data:f,headers:Object.fromEntries(s.headers.entries()),duration:k}}function P(t){return typeof t=="object"?JSON.stringify(t,null,2):String(t)}function G(t,n){let r={};return t.forEach(a=>{a.required&&!n[a.name]&&(r[a.name]=`${a.label} ist erforderlich`)}),{valid:Object.keys(r).length===0,errors:r}}function O({api:t,onResponse:n,initialValues:r=null}){let[a,i]=d({}),[c,p]=d({}),[m,h]=d(!1);T(()=>{if(t){let o={};t.fields.forEach(u=>{r&&r[u.name]!==void 0?o[u.name]=r[u.name]:o[u.name]=u.defaultValue!==void 0?u.defaultValue:""}),i(o),p({})}},[t,r]);let v=(o,u)=>{i(s=>({...s,[o]:u})),c[o]&&p(s=>{let f={...s};return delete f[o],f})},N=async o=>{o.preventDefault();let u=G(t.fields,a);if(!u.valid){p(u.errors);return}h(!0),p({});try{let s=F(t.id),f=await V({endpoint:t.endpoint,method:t.method,payload:a,authConfig:s,apiId:t.id,apiName:t.name,contentType:t.contentType,accept:t.accept});n(f)}catch(s){n({ok:!1,status:0,statusText:"Error",data:null,error:s.message})}finally{h(!1)}},l=o=>{o.ctrlKey&&o.key==="Enter"&&N(o)};return t?e.createElement("form",{className:"request-form",onSubmit:N,onKeyDown:l},e.createElement("h3",null,t.name," \u2013 Request"),t.fields.map(o=>e.createElement("div",{key:o.name,className:"form-group"},e.createElement("label",{htmlFor:o.name},o.label,o.required&&e.createElement("span",{className:"required"},"*")),o.type==="select"?e.createElement("select",{id:o.name,value:a[o.name]||"",onChange:u=>v(o.name,u.target.value),required:o.required},o.options.map(u=>e.createElement("option",{key:u.value,value:u.value},u.label))):o.type==="textarea"?e.createElement("textarea",{id:o.name,value:a[o.name]||"",onChange:u=>v(o.name,u.target.value),required:o.required,rows:4}):e.createElement("input",{type:o.type,id:o.name,value:a[o.name]||"",onChange:u=>{let s=o.type==="number"?u.target.value===""?"":parseFloat(u.target.value):u.target.value;v(o.name,s)},step:o.step,required:o.required}),c[o.name]&&e.createElement("span",{className:"error-message"},c[o.name]))),e.createElement("div",{className:"form-actions"},e.createElement("button",{type:"submit",className:"btn-primary btn-submit",disabled:m},m?"Sende...":"API aufrufen"),e.createElement("small",{className:"hint"},"Tipp: Strg+Enter zum Absenden"))):e.createElement("div",{className:"request-form"},e.createElement("p",null,"Bitte w\xE4hlen Sie eine API aus."))}function q({response:t}){let n=U(null),r=i=>(typeof i!="string"&&(i=P(i)),i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"([^"]+)":/g,'<span class="json-key">"$1"</span>:').replace(/: "([^"]*)"/g,': <span class="json-string">"$1"</span>').replace(/: (true|false)/g,': <span class="json-boolean">$1</span>').replace(/: (null)/g,': <span class="json-null">$1</span>').replace(/: (-?\d+\.?\d*)/g,': <span class="json-number">$1</span>'));if(T(()=>{if(n.current&&t&&t.data!==null){let i=P(t.data),c=r(i);n.current.innerHTML=c}},[t]),!t)return e.createElement("div",{className:"response-viewer"},e.createElement("h3",null,"Response"),e.createElement("pre",{className:"response-content"},"Noch keine Anfrage gesendet."));let a=t.ok?"status-success":"status-error";return e.createElement("div",{className:"response-viewer"},e.createElement("div",{className:"response-header"},e.createElement("h3",null,"Response"),e.createElement("div",{className:`status-badge ${a}`},"HTTP ",t.status," ",t.statusText),t.duration&&e.createElement("div",{className:"duration-badge"},t.duration,"ms")),t.error?e.createElement("pre",{className:"response-content error"},"Fehler: ",t.error):e.createElement("pre",{ref:n,className:"response-content"}))}function K({apiId:t}){let[n,r]=d("none"),[a,i]=d(""),[c,p]=d(""),[m,h]=d("X-API-Key");T(()=>{if(t){let l=F(t);l?(r(l.type),i(l.token||""),p(l.apiKey||""),h(l.headerName||"X-API-Key")):(r("none"),i(""),p(""),h("X-API-Key"))}},[t]);let v=()=>{if(!t)return;let l={type:n};n==="bearer"?l.token=a:n==="apikey"&&(l.apiKey=c,l.headerName=m),X(t,l),alert("Auth-Konfiguration gespeichert!")},N=()=>{t&&(Y(t),r("none"),i(""),p(""),h("X-API-Key"),alert("Auth-Konfiguration gel\xF6scht!"))};return t?e.createElement("div",{className:"auth-config"},e.createElement("h3",null,"Authentifizierung"),e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"auth-type"},"Auth-Typ:"),e.createElement("select",{id:"auth-type",value:n,onChange:l=>r(l.target.value)},e.createElement("option",{value:"none"},"Keine"),e.createElement("option",{value:"bearer"},"Bearer Token"),e.createElement("option",{value:"apikey"},"API Key"))),n==="bearer"&&e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"bearer-token"},"Bearer Token:"),e.createElement("input",{type:"text",id:"bearer-token",value:a,onChange:l=>i(l.target.value),placeholder:"Token eingeben..."}),e.createElement("small",{className:"warning"},"\u26A0\uFE0F Nur f\xFCr Testzwecke! Token wird in LocalStorage gespeichert.")),n==="apikey"&&e.createElement(e.Fragment,null,e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"api-key"},"API Key:"),e.createElement("input",{type:"text",id:"api-key",value:c,onChange:l=>p(l.target.value),placeholder:"API Key eingeben..."})),e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"header-name"},"Header-Name:"),e.createElement("input",{type:"text",id:"header-name",value:m,onChange:l=>h(l.target.value),placeholder:"z.B. X-API-Key"})),e.createElement("small",{className:"warning"},"\u26A0\uFE0F Nur f\xFCr Testzwecke! Key wird in LocalStorage gespeichert.")),e.createElement("div",{className:"auth-actions"},e.createElement("button",{onClick:v,className:"btn-primary"},"Speichern"),e.createElement("button",{onClick:N,className:"btn-secondary"},"L\xF6schen"))):e.createElement("div",{className:"auth-config"},e.createElement("p",null,"Bitte w\xE4hlen Sie zuerst eine API aus."))}function D({onReplay:t}){let[n,r]=d([]),[a,i]=d([]),[c,p]=d("all"),m=()=>{let s=x();r(s);let f=s.filter(b=>J(b.id)).map(b=>b.id);i(f)};T(()=>{m()},[]);let h=s=>{confirm("M\xF6chten Sie diesen Eintrag wirklich l\xF6schen?")&&(B(s),m())},v=()=>{confirm("M\xF6chten Sie die gesamte Historie wirklich l\xF6schen?")&&(_(),m())},N=s=>{z(s),m()},l=s=>{t({apiId:s.apiId,payload:s.payload})},o=s=>new Date(s).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),u=c==="favorites"?n.filter(s=>a.includes(s.id)):n;return e.createElement("div",{className:"history"},e.createElement("div",{className:"history-header"},e.createElement("h3",null,"Request-Historie"),e.createElement("div",{className:"history-controls"},e.createElement("div",{className:"filter-buttons"},e.createElement("button",{className:c==="all"?"active":"",onClick:()=>p("all")},"Alle (",n.length,")"),e.createElement("button",{className:c==="favorites"?"active":"",onClick:()=>p("favorites")},"\u2B50 Favoriten (",a.length,")")),n.length>0&&e.createElement("button",{className:"btn-danger btn-small",onClick:v},"Alle l\xF6schen"))),u.length===0?e.createElement("p",{className:"no-history"},c==="favorites"?"Keine Favoriten vorhanden.":"Noch keine Requests in der Historie."):e.createElement("div",{className:"history-list"},u.map(s=>{let f=s.status>=200&&s.status<300?"status-success":"status-error";return e.createElement("div",{key:s.id,className:"history-item"},e.createElement("div",{className:"history-item-header"},e.createElement("span",{className:"api-name"},s.apiName),e.createElement("span",{className:`status ${f}`},s.status," ",s.statusText),e.createElement("span",{className:"timestamp"},o(s.timestamp))),e.createElement("div",{className:"history-item-details"},e.createElement("div",{className:"endpoint"},e.createElement("strong",null,s.method)," ",s.endpoint),s.duration&&e.createElement("div",{className:"duration"},s.duration,"ms")),e.createElement("div",{className:"history-item-actions"},e.createElement("button",{className:"btn-icon",onClick:()=>N(s.id),title:a.includes(s.id)?"Favorit entfernen":"Als Favorit markieren"},a.includes(s.id)?"\u2B50":"\u2606"),e.createElement("button",{className:"btn-small btn-primary",onClick:()=>l(s)},"\u21BB Wiederholen"),e.createElement("button",{className:"btn-small btn-danger",onClick:()=>h(s.id)},"\u{1F5D1}\uFE0F L\xF6schen")))})))}function Z(){let[t,n]=d([]),[r,a]=d(null),[i,c]=d(null),[p,m]=d(null),[h,v]=d("request"),[N,l]=d(!0),[o,u]=d(null);T(()=>{s()},[]);let s=async()=>{try{l(!0);let g=await fetch("/config/apis.json");if(!g.ok)throw new Error(`Fehler beim Laden der APIs: ${g.statusText}`);let y=await g.json();n(y.apis||[]),y.apis&&y.apis.length>0&&a(y.apis[0]),l(!1)}catch(g){u(g.message),l(!1),console.error("Fehler beim Laden der APIs:",g)}},f=g=>{a(g),c(null),m(null),v("request")},b=g=>{c(g)},k=g=>{let y=t.find(I=>I.id===g.apiId);y&&(a(y),m(g.payload),v("request"))};return N?e.createElement("div",{className:"app-container"},e.createElement("div",{className:"loading"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"Lade API-Konfiguration..."))):o?e.createElement("div",{className:"app-container"},e.createElement("div",{className:"error-container"},e.createElement("h2",null,"Fehler beim Laden"),e.createElement("p",null,o),e.createElement("button",{onClick:s,className:"btn-primary"},"Erneut versuchen"))):t.length===0?e.createElement("div",{className:"app-container"},e.createElement("div",{className:"error-container"},e.createElement("h2",null,"Keine APIs konfiguriert"),e.createElement("p",null,"Bitte f\xFCgen Sie API-Definitionen in ",e.createElement("code",null,"config/apis.json")," hinzu."))):e.createElement("div",{className:"app-container"},e.createElement("header",{className:"app-header"},e.createElement("h1",null,"\u{1F680} API Test Framework"),e.createElement("p",{className:"subtitle"},"Flexibles Testing f\xFCr REST APIs")),e.createElement("div",{className:"api-selector-container"},e.createElement(H,{apis:t,selectedApiId:r?.id,onSelect:f})),e.createElement("div",{className:"main-content"},e.createElement("div",{className:"sidebar"},e.createElement("div",{className:"tabs"},e.createElement("button",{className:`tab ${h==="request"?"active":""}`,onClick:()=>v("request")},"\u{1F4DD} Request"),e.createElement("button",{className:`tab ${h==="auth"?"active":""}`,onClick:()=>v("auth")},"\u{1F510} Auth"),e.createElement("button",{className:`tab ${h==="history"?"active":""}`,onClick:()=>v("history")},"\u{1F4DC} Historie")),e.createElement("div",{className:"tab-content"},h==="request"&&e.createElement(O,{api:r,onResponse:b,initialValues:p}),h==="auth"&&e.createElement(K,{apiId:r?.id}),h==="history"&&e.createElement(D,{onReplay:k}))),e.createElement("div",{className:"response-panel"},e.createElement(q,{response:i}))),e.createElement("footer",{className:"app-footer"},e.createElement("p",null,"API Test Framework v1.0 | React + esbuild")))}var R=L.createRoot(document.getElementById("root"));R.render(e.createElement(Z,null));})();
